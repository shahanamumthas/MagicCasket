<!DOCTYPE html>
<html lang="en">

<head>
    <title>Shoping Cart</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--===============================================================================================-->
    <link rel="icon" type="image/png" href="/images/icons/mc-logo-letter-design-vector-14081808.jpg">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
    <!--===============================================================================================-->
    <!-- <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css"> -->
    <!--===============================================================================================-->
    <!-- <link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css"> -->
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="fonts/linearicons-v1.0.0/icon-font.css">

    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="vendor/perfect-scrollbar/perfect-scrollbar.css">
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="css/util.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" href="./notify.min.css" />
    <!--===============================================================================================-->
</head>

<body class="animsition">

    <!-- Header -->
    <%- include('./partials/head.ejs') -%>

        <!-- Shoping Cart -->
        <form class="bg0 p-t-75 m-t-50 p-b-85" action="/postCheckout" method="post">
            <div class="container">
                <div class="row">
                    <div class="col-lg-10 col-xl-7 m-lr-auto m-b-50">
                        <div class="m-l-25 m-r--38 m-lr-0-xl">
                            <!-- <div class="wrap-table-shopping-cart"> -->

                            <div class="">
                                <table class="table-shopping-cart">


                                    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
                                        
                                   
                                        <tr class="table_head">
                                            <th class="column-1" >
                                                My Wishlist
                                            </th>
                                        </tr>
                                        <tr class="table_row">
                                            <td class="column-1">
                                                <div class="how-itemcart1">
                                                    <img src=" = data.productId.images[0].path " alt="IMG">
                                                </div>
                                            </td>
                                            <td class="column-2">
                                               name
                                            </td>
                                            <td class="column-3">
                                               price
                                            </td>
                                            
    
                                            <td class="column-5">
                                                <a href="/delCartItem/ = data.productId._id " role="button">
                                                    <i class="fas fa-times"></i>
                                                </a>
                                            </td>
                                        </tr>
    
                                       
                                    <!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->

                                    <tr class="table_row">
                                        <td class="column-5 txt-center">

                                            Delivery Address

                                        </td>
                                        <td class="column-5" style="color: rgb(113, 112, 112); size: 0.3rem;">
                                            select your address
                                        </td>
                                        <br>


                                        <td class="column-5">

                                            <input type="hidden" name="totals" value="= totals ">

                                            <a href="/addAddress?total= totals"
                                                class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer">
                                                ADD ADDRESS
                                            </a>



                                        </td>
                                    </tr>



                                    <!-- <div class="form-check">
                                        <input class="form-check-input" type="radio" name="flexRadioDefault"
                                            id="flexRadioDefault2" checked>
                                        <label class="form-check-label" for="flexRadioDefault2">
                                            Default checked radio
                                        </label>
                                    </div> -->



                                     if(data.address.length>0) { 
                                         data.address.forEach((address)=> { 
                                            <tr>

                                                <div class="card">
                                                    <div class="card-body">

                                                        <div class="p-l-25 form-check">

                                                            <input class="form-check-input" type="radio" name="address"
                                                                id="flexRadioDefault1" value="= address._id">
                                                            <label style="size: 10px;" class="form-check-label"
                                                                for="flexRadioDefault1">
                                                                = address.fname
                                                            </label>
                                                        </div>
                                                        <br>
                                                        <h5 class="card-title">
                                                            = address.fname 
                                                                = address.lname 
                                                        </h5>
                                                        <h6 class="card-subtitle mb-2 text-muted">
                                                            = address.housename 
                                                        </h6>
                                                        <p class="card-text">
                                                            = address.city ,= address.state ,= address.pin 
                                                        </p>
                                                        <p class="card-text">
                                                            = address.country
                                                        </p>
                                                        <br>
                                                        <!-- <a href="/editAddress?id== address._id"
                                                            class="card-link" style="color: rgb(82, 82, 82);">Edit</a> -->
                                                        <button type="button" class=" text-danger" data-toggle="modal"
                                                            data-target="#exampleModal= address._id"
                                                            class="card-link">Delete</button>


                                                    </div>
                                                </div>

                                            </tr>

                                            <!-- Modal -->
                                            <div class="modal fade" id="exampleModal= address._id" tabindex="-1"
                                                role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="exampleModalLabel">Modal title
                                                            </h5>
                                                            <button type="button" class="close" data-dismiss="modal"
                                                                aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body">
                                                            Are you sure you want to delete this address =
                                                                address.housename 
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary"
                                                                data-dismiss="modal">Close</button>
                                                            <a type="button"
                                                                href="/deleteOrderAddress?id== address._id"
                                                                class="btn btn-danger">Delete</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            })
                                                 }


                                </table>
                            </div>
                        </div>
                    </div>

                    <div class=" col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50">
                        <div class="">
                            <div class=" p-lr-40 p-t-3 p-b-10 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">


                                <!--  -->

                                <!-- <div class="flex-w flex-t bor12 p-t-15 p-b-30">
                                    <div class="size-208 w-full-ssm">
                                        
                                    </div>
    
                                    <div class="size-209 p-r-18 p-r-0-sm w-full-ssm">
                                        <div class="p-t-15">
                                            <div class="flex-w">
                                            
                                            </div>
    
                                        </div>
                                    </div>
                                </div> -->

                                <div class="flex-w flex-t p-t-14 p-b-33">
                                    <input type="hidden" value="= " id="hiddenTotal">
                                    <div class="size-102">
                                        <span class="mtext-101 cl2" id="cartTotal">
                                            <label for="Coupon">Apply Coupon</label><input id="Coupon"
                                                class="form-control form-control-user" type="text"
                                                placeholder="Apply Coupon">
                                        </span>
                                    </div>

                                    <div class="size-209 p-t-1">
                                        <span class="mtext-110 cl2" id="cartTotal">

                                        </span>
                                    </div>
                                </div>
                                <!-- <h4 class="mtext-109 cl2 p-b-10">
                                    Cart Totals
                                </h4> -->
                                <span class="mtext-101 cl2" id="cartTotal">
                                    <input type="hidden" name="total" value="= totals">
                                    Total: = totals 
                                </span>


                                <h4 class="mtext-109 cl2 p-b-30">
                                    Payment Method
                                </h4>
                                <hr>
                                <input class="form-check-input" type="radio" name="paymentMethod" id="flexRadioDefault1"
                                    value="COD">
                                <label style="size: 10px;" class="form-check-label" for="flexRadioDefault1">
                                    COD
                                </label>
                                <input class="form-check-input" type="radio" name="paymentMethod" id="flexRadioDefault1"
                                    value="Online">
                                <label style="size: 10px;" class="form-check-label" for="flexRadioDefault1">
                                    Online Payment
                                </label>

                            </div>
                        </div>
                        <div class="">
                            <div class=" p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">


                                <div class="modal-dialog modal-dialog-centered">
                                    <input type="submit" value=" Place Order"
                                        class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer">
                                </div>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </form>





        <%- include('./partials/footer') -%>

            <!-- Back to top -->
            <div class="btn-back-to-top" id="myBtn">
                <span class="symbol-btn-back-to-top">
                    <i class="zmdi zmdi-chevron-up"></i>
                </span>
            </div>

            <script>
                var total;
                function increaseCount(productId) {

                    const countAdd = document.getElementById(`count1${productId}`)
                    const addPars = parseInt(countAdd.value)
                    const add = addPars + 1

                    fetch('/countInc', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            add,
                            productId
                        })
                    })
                        .then(response => response.json())
                        .then(response => {
                            if (response.success) {
                                if (response.product.stock >= response.inc) {
                                    document.getElementById(`totalInd${response.product._id}`).innerText = response.total;
                                    total = 0;
                                    cartTotal(response)
                                } else {

                                    document.getElementById(`count1${productId}`).value = response.product.stock
                                    Toastify({
                                        text: `Only ${response.product.stock} is availiable`,
                                        duration: 3000,
                                        newWindow: true,
                                        close: true,
                                        gravity: "bottom", // top or bottom
                                        position: "center", // left, center or right
                                        backgroundColor: "linear-gradient(to right, #FF0000, #000000)",
                                    }).showToast();

                                }
                            } else {
                                console.log('Failed');
                            }
                        })
                }

                function decreaseCount(productId) {
                    const countLess = document.getElementById(`count1${productId}`)
                    const lessPars = parseInt(countLess.value)
                    const less = lessPars - 1

                    fetch('/countDec', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            less,
                            productId
                        })
                    })
                        .then(response => response.json())
                        .then(response => {
                            if (response.success) {
                                if (response.inc >= 0) {
                                    document.getElementById(`totalInd${response.product._id}`).innerText = response.total
                                    total = 1;
                                    cartTotal(response)
                                } else {
                                    document.getElementById(`count1${productId}`).value = response.product.stock
                                    Toastify({
                                        text: `Quantity should be greater than zero`,
                                        duration: 3000,
                                        newWindow: true,
                                        close: true,
                                        gravity: "bottom", // top or bottom
                                        position: "center", // left, center or right
                                        backgroundColor: "linear-gradient(to right, #FF0000, #000000)",
                                    }).showToast();

                                }
                            } else {
                                console.log('Failed');
                            }
                        })
                }
                let hiddenTotal = document.getElementById('hiddenTotal').value
                let totalset = parseInt(hiddenTotal);
                function cartTotal(response) {
                    if (total == 0) {
                        totalset = totalset + response.product.price;
                    } else {
                        totalset = totalset - response.product.price;
                    }

                    document.getElementById(`cartTotal`).innerText = `Total : ${totalset}`
                }

                $('#myModal').on('shown.bs.modal', function () {
                    $('#myInput').trigger('focus')
                })

            </script>
            <script src="./notify.min.js"></script>
            <!--===============================================================================================-->
            <!-- <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> -->

            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.css">
            <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>

            <!--===============================================================================================-->
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
            <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

            <!--===============================================================================================-->
            <script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>
            <!--===============================================================================================-->
            <script src="vendor/jquery/jquery-3.2.1.min.js"></script>
            <!--===============================================================================================-->
            <script src="vendor/animsition/js/animsition.min.js"></script>
            <!--===============================================================================================-->
            <script src="vendor/bootstrap/js/popper.js"></script>
            <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
            <!--===============================================================================================-->
            <script src="vendor/select2/select2.min.js"></script>
            <script>
                $(".js-select2").each(function () {
                    $(this).select2({
                        minimumResultsForSearch: 20,
                        dropdownParent: $(this).next('.dropDownSelect2')
                    });
                })
            </script>
            <!--===============================================================================================-->
            <script src="vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
            <!--===============================================================================================-->
            <script src="vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
            <script>
                $('.js-pscroll').each(function () {
                    $(this).css('position', 'relative');
                    $(this).css('overflow', 'hidden');
                    var ps = new PerfectScrollbar(this, {
                        wheelSpeed: 1,
                        scrollingThreshold: 1000,
                        wheelPropagation: false,
                    });

                    $(window).on('resize', function () {
                        ps.update();
                    })
                });
            </script>
            <!--===============================================================================================-->
            <script src="js/main.js"></script>

</body>

</html>